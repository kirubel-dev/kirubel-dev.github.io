<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatterApp</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Emoji Picker -->
    <script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.15.1/index.min.js" type="module"></script>
    <style id="app-style">
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --dark-bg: #111827;
            --dark-card: #1f2937;
            --dark-input: #374151;
            --light-bg: #f9fafb;
            --light-card: #ffffff;
            --light-input: #f3f4f6;
            --sender-bubble: #4f46e5;
            --receiver-bubble: #374151;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
            overflow: hidden;
            height: 100vh;
        }
        
        body.dark {
            background-color: var(--dark-bg);
            color: #e5e7eb;
        }
        
        body.light {
            background-color: var(--light-bg);
            color: #1f2937;
        }
        
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            overflow: hidden;
        }
        
        .dark .animated-bg {
            background: linear-gradient(125deg, #111827 0%, #1e3a8a 100%);
        }
        
        .light .animated-bg {
            background: linear-gradient(125deg, #f9fafb 0%, #dbeafe 100%);
        }
        
        .bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            animation: float 20s infinite ease-in-out;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(10px, 15px) rotate(5deg); }
            50% { transform: translate(5px, 8px) rotate(10deg); }
            75% { transform: translate(-5px, 12px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        
        .app-container {
            height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .auth-container {
            max-width: 450px;
            width: 90%;
            margin: 0 auto;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .dark .auth-container {
            background-color: var(--dark-card);
        }
        
        .light .auth-container {
            background-color: var(--light-card);
        }
        
        .chat-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .sidebar {
            flex: 0 0 320px;
            transition: all 0.3s ease;
        }
        
        .dark .sidebar {
            background-color: var(--dark-card);
            border-right: 1px solid #374151;
        }
        
        .light .sidebar {
            background-color: var(--light-card);
            border-right: 1px solid #e5e7eb;
        }
        
        .chat-window {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .chat-header {
            padding: 1rem;
            transition: all 0.3s ease;
        }
        
        .dark .chat-header {
            background-color: var(--dark-card);
            border-bottom: 1px solid #374151;
        }
        
        .light .chat-header {
            background-color: var(--light-card);
            border-bottom: 1px solid #e5e7eb;
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            scroll-behavior: smooth;
        }
        
        .message {
            max-width: 75%;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            position: relative;
            transition: all 0.3s ease;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.sent {
            margin-left: auto;
            background-color: var(--sender-bubble);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }
        
        .message.received {
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
        }
        
        .dark .message.received {
            background-color: var(--receiver-bubble);
        }
        
        .light .message.received {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        
        .message-input-container {
            padding: 1rem;
            transition: all 0.3s ease;
        }
        
        .dark .message-input-container {
            background-color: var(--dark-card);
            border-top: 1px solid #374151;
        }
        
        .light .message-input-container {
            background-color: var(--light-card);
            border-top: 1px solid #e5e7eb;
        }
        
        .message-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .dark .message-input {
            background-color: var(--dark-input);
            color: white;
        }
        
        .light .message-input {
            background-color: var(--light-input);
            color: #1f2937;
        }
        
        .online-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .online {
            background-color: #10b981;
        }
        
        .offline {
            background-color: #9ca3af;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            font-style: italic;
            color: #9ca3af;
        }
        
        .skeleton {
            animation: pulse 1.5s infinite;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.2),
                rgba(255, 255, 255, 0.1)
            );
            background-size: 200% 100%;
            border-radius: 0.5rem;
        }
        
        @keyframes pulse {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }
        
        .scroll-to-top {
            position: absolute;
            bottom: 6rem;
            right: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .scroll-to-top.visible {
            opacity: 1;
        }
        
        .emoji-picker {
            position: absolute;
            bottom: 4.5rem;
            right: 1rem;
            z-index: 10;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
            }
            
            .sidebar {
                flex: 0 0 auto;
                width: 100%;
                height: 100%;
                position: absolute;
                left: 0;
                top: 0;
                z-index: 10;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .mobile-toggle {
                display: flex !important;
            }
        }
        
        .message-receipt {
            position: absolute;
            right: 0.5rem;
            bottom: 0.25rem;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .slide-in {
            animation: slideIn 0.3s ease forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .mobile-toggle {
            display: none;
        }
    </style>
</head>
<body class="dark">
    <div id="root"></div>

    <script type="text/babel" id="app-script">
        // React Components
        const { useState, useEffect, useRef } = React;
        
        // Mock data for prototype
        const MOCK_USERS = [
            { id: 'user1', name: 'You', avatar: 'https://randomuser.me/api/portraits/men/32.jpg', online: true },
            { id: 'user2', name: 'Alex Morgan', avatar: 'https://randomuser.me/api/portraits/women/44.jpg', online: true },
            { id: 'user3', name: 'James Wilson', avatar: 'https://randomuser.me/api/portraits/men/41.jpg', online: false },
            { id: 'user4', name: 'Emma Thompson', avatar: 'https://randomuser.me/api/portraits/women/24.jpg', online: true },
            { id: 'user5', name: 'Robert Chen', avatar: 'https://randomuser.me/api/portraits/men/59.jpg', online: false },
            { id: 'user6', name: 'Group: Design Team', isGroup: true, avatar: 'https://cdn.pixabay.com/photo/2016/03/29/04/47/team-1287634_1280.jpg', online: true },
        ];
        
        const MOCK_CHATS = [
            {
                id: 'chat1',
                users: ['user1', 'user2'],
                lastMessage: { text: 'Hey, how are you doing?', timestamp: new Date(Date.now() - 1000 * 60 * 5), sender: 'user2' }
            },
            {
                id: 'chat2',
                users: ['user1', 'user3'],
                lastMessage: { text: 'Did you finish the report?', timestamp: new Date(Date.now() - 1000 * 60 * 60), sender: 'user1' }
            },
            {
                id: 'chat3',
                users: ['user1', 'user4'],
                lastMessage: { text: 'Let\'s meet tomorrow at 10', timestamp: new Date(Date.now() - 1000 * 60 * 60 * 3), sender: 'user4' }
            },
            {
                id: 'chat4',
                users: ['user1', 'user5'],
                lastMessage: { text: "I'll review the code and get back to you", timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24), sender: 'user5' }
            },
            {
                id: 'chat5',
                users: ['user1', 'user2', 'user3', 'user4'],
                isGroup: true,
                name: 'Design Team',
                lastMessage: { text: 'New mockups are ready for review!', timestamp: new Date(Date.now() - 1000 * 60 * 30), sender: 'user4' }
            }
        ];

        const MOCK_MESSAGES = {
            'chat1': [
                { id: 'm1', text: 'Hey there!', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 60), read: true },
                { id: 'm2', text: 'Hi! How are you?', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 59), read: true },
                { id: 'm3', text: 'I\'m good, thanks for asking. What about you?', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 55), read: true },
                { id: 'm4', text: 'I\'m doing well too! Just finishing up some work.', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 50), read: true },
                { id: 'm5', text: 'Cool! Are we still meeting tomorrow?', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 45), read: true },
                { id: 'm6', text: 'Yes, absolutely! I was thinking we could meet at the coffee shop at 2pm?', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 40), read: true },
                { id: 'm7', text: 'Sounds perfect to me! I\'ll be there.', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 35), read: true },
                { id: 'm8', text: 'Great! Looking forward to it.', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 30), read: true },
                { id: 'm9', text: 'By the way, have you seen the new design proposal?', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 25), read: true },
                { id: 'm10', text: 'Not yet. Could you share it with me?', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 20), read: true },
                { id: 'm11', text: 'Sure, I just sent it to your email.', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 15), read: true },
                { id: 'm12', text: 'Got it, thanks! I\'ll take a look at it right away.', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 10), read: true },
                { id: 'm13', text: 'Hey, how are you doing?', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 5), read: false },
            ],
            'chat5': [
                { id: 'g1', text: 'Hi everyone! Welcome to our design team chat.', sender: 'user4', timestamp: new Date(Date.now() - 1000 * 60 * 180), read: true },
                { id: 'g2', text: 'Hello team!', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 175), read: true },
                { id: 'g3', text: 'Hey there, excited to work with you all!', sender: 'user3', timestamp: new Date(Date.now() - 1000 * 60 * 170), read: true },
                { id: 'g4', text: 'Let\'s discuss the project timeline.', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 165), read: true },
                { id: 'g5', text: 'I think we should start with user research next week.', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 160), read: true },
                { id: 'g6', text: 'That works for me.', sender: 'user3', timestamp: new Date(Date.now() - 1000 * 60 * 155), read: true },
                { id: 'g7', text: 'I\'ve prepared some initial mockups for review.', sender: 'user4', timestamp: new Date(Date.now() - 1000 * 60 * 150), read: true },
                { id: 'g8', text: 'They look great! Just a few suggestions on the color palette.', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 145), read: true },
                { id: 'g9', text: 'I agree, maybe we can go with a more vibrant blue?', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 140), read: true },
                { id: 'g10', text: 'Good idea. I\'ll make those changes and share the updated version.', sender: 'user4', timestamp: new Date(Date.now() - 1000 * 60 * 135), read: true },
                { id: 'g11', text: 'When is our next client meeting scheduled?', sender: 'user3', timestamp: new Date(Date.now() - 1000 * 60 * 100), read: true },
                { id: 'g12', text: 'It\'s on Friday at 2 PM.', sender: 'user2', timestamp: new Date(Date.now() - 1000 * 60 * 95), read: true },
                { id: 'g13', text: 'I\'ll prepare a presentation for that.', sender: 'user1', timestamp: new Date(Date.now() - 1000 * 60 * 90), read: true },
                { id: 'g14', text: 'Great! Let me know if you need any assets from me.', sender: 'user4', timestamp: new Date(Date.now() - 1000 * 60 * 85), read: true },
                { id: 'g15', text: 'New mockups are ready for review!', sender: 'user4', timestamp: new Date(Date.now() - 1000 * 60 * 30), read: false },
            ]
        };

        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function formatDate(date) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (date.toDateString() === today.toDateString()) {
                return formatTime(date);
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'Yesterday';
            } else {
                return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
            }
        }

        // Create animated background component
        const AnimatedBackground = () => {
            return (
                <div className="animated-bg">
                    {[...Array(6)].map((_, i) => (
                        <div
                            key={i}
                            className="bubble"
                            style={{
                                left: `${Math.random() * 100}%`,
                                top: `${Math.random() * 100}%`,
                                width: `${Math.random() * 300 + 100}px`,
                                height: `${Math.random() * 300 + 100}px`,
                                opacity: Math.random() * 0.1 + 0.05
                            }}
                        />
                    ))}
                </div>
            );
        };

        // Auth component
        const Auth = ({ onLogin }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            
            const handleSubmit = (e) => {
                e.preventDefault();
                console.log('Login/Signup button clicked');
                onLogin();
            };
            
            return (
                <div className="flex items-center justify-center h-screen">
                    <div className="auth-container">
                        <h2 className="text-2xl font-bold mb-6 text-center">
                            {isLogin ? "Welcome back" : "Create an account"}
                        </h2>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-sm font-medium mb-2" htmlFor="email">
                                    Email
                                </label>
                                <input
                                    type="email"
                                    id="email"
                                    className="w-full px-4 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-700"
                                    placeholder="you@example.com"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-6">
                                <label className="block text-sm font-medium mb-2" htmlFor="password">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    id="password"
                                    className="w-full px-4 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-700"
                                    placeholder="••••••••"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition duration-300"
                            >
                                {isLogin ? "Sign In" : "Sign Up"}
                            </button>
                            
                            <div className="mt-4 text-center">
                                <span className="text-sm">or</span>
                            </div>
                            
                            <button
                                type="button"
                                className="w-full flex items-center justify-center mt-4 bg-white text-gray-800 font-medium py-2 px-4 rounded-lg border border-gray-300 hover:bg-gray-50 transition duration-300"
                                onClick={() => {
                                    console.log('Google sign-in button clicked');
                                    onLogin();
                                }}
                            >
                                <svg className="w-5 h-5 mr-2" viewBox="0 0 24 24">
                                    <path fill="#EA4335" d="M5.26620003,9.76452941 C6.19878754,6.93863203 8.85444915,4.90909091 12,4.90909091 C13.6909091,4.90909091 15.2181818,5.50909091 16.4181818,6.49090909 L19.9090909,3 C17.7818182,1.14545455 15.0545455,0 12,0 C7.27006974,0 3.1977497,2.69829785 1.23999023,6.65002441 L5.26620003,9.76452941 Z" />
                                    <path fill="#34A853" d="M16.0407269,18.0125889 C14.9509167,18.7163016 13.5660892,19.0909091 12,19.0909091 C8.86648613,19.0909091 6.21911939,17.076871 5.27698177,14.2678769 L1.23746264,17.3349879 C3.19279051,21.2936293 7.26500293,24 12,24 C14.9328362,24 17.7353462,22.9573905 19.834192,20.9995801 L16.0407269,18.0125889 Z" />
                                    <path fill="#4A90E2" d="M19.834192,20.9995801 C22.0291676,18.9520994 23.4545455,15.903663 23.4545455,12 C23.4545455,11.2909091 23.3454545,10.5272727 23.1818182,9.81818182 L12,9.81818182 L12,14.4545455 L18.4363636,14.4545455 C18.1187732,16.013626 17.2662994,17.2212117 16.0407269,18.0125889 L19.834192,20.9995801 Z" />
                                    <path fill="#FBBC05" d="M5.27698177,14.2678769 C5.03832634,13.556323 4.90909091,12.7937589 4.90909091,12 C4.90909091,11.2182781 5.03443647,10.4668121 5.26620003,9.76452941 L1.23999023,6.65002441 C0.43658717,8.26043162 0,10.0753848 0,12 C0,13.9195484 0.444780743,15.7301709 1.23746264,17.3349879 L5.27698177,14.2678769 Z" />
                                </svg>
                                Sign in with Google
                            </button>
                            
                            <div className="mt-6 text-center">
                                <button
                                    type="button"
                                    className="text-indigo-500 hover:underline text-sm"
                                    onClick={() => setIsLogin(!isLogin)}
                                >
                                    {isLogin ? "Need an account? Sign up" : "Already have an account? Sign in"}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Chat List Item component
        const ChatListItem = ({ chat, users, isActive, onClick }) => {
            const otherUser = users.find(user => {
                if (chat.isGroup) return user.isGroup && user.name === `Group: ${chat.name}`;
                return chat.users.includes(user.id) && user.id !== 'user1';
            });
            
            // Handle case where otherUser is not found
            if (!otherUser) {
                console.error('Could not find other user for chat:', chat);
                return null; // Don't render this chat item if we can't find the user
            }
            
            const lastMessage = chat.lastMessage;
            const isLastMessageFromMe = lastMessage?.sender === 'user1';
            
            return (
                <div
                    className={`flex items-center p-3 cursor-pointer rounded-lg transition-colors duration-200 ${isActive ? 'bg-indigo-100 dark:bg-indigo-900/30' : ''}`}
                    onClick={() => onClick(chat.id)}
                >
                    <div className="relative flex-shrink-0">
                        <img src={otherUser.avatar} alt={otherUser.name} className="w-12 h-12 rounded-full object-cover" />
                        <span className={`online-indicator absolute bottom-0 right-0 border-2 ${otherUser.online ? 'online' : 'offline'} border-white dark:border-gray-800`}></span>
                    </div>
                    <div className="ml-3 flex-1 min-w-0">
                        <div className="flex justify-between items-center">
                            <h3 className="text-sm font-semibold truncate">
                                {otherUser.name}
                                {chat.isGroup && <span className="ml-1 text-xs font-normal text-gray-500">({chat.users.length})</span>}
                            </h3>
                            <span className="text-xs text-gray-500">
                                {formatDate(lastMessage?.timestamp)}
                            </span>
                        </div>
                        <div className="flex justify-between items-center mt-1">
                            <p className="text-sm text-gray-500 truncate">
                                {isLastMessageFromMe && <span className="font-medium mr-1">You:</span>}
                                {lastMessage?.text}
                            </p>
                            {!isLastMessageFromMe && lastMessage && (
                                <span className="flex-shrink-0 rounded-full bg-indigo-500 w-2 h-2"></span>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Message component
        const Message = ({ message, user, isGroup }) => {
            const isSent = message.sender === 'user1';
            const messageUser = user || { name: 'Unknown' };
            
            return (
                <div
                    className={`message ${isSent ? 'sent' : 'received'}`}
                >
                    {isGroup && !isSent && (
                        <div className="flex items-center mb-1">
                            <img src={messageUser.avatar} alt={messageUser.name} className="w-5 h-5 rounded-full mr-1" />
                            <span className="text-xs font-medium">{messageUser.name}</span>
                        </div>
                    )}
                    <div>{message.text}</div>
                    <div className="text-xs opacity-70 text-right mt-1">
                        {formatTime(message.timestamp)}
                    </div>
                    {isSent && (
                        <div className="message-receipt">
                            {message.read ? (
                                <i className="fas fa-check-double"></i>
                            ) : (
                                <i className="fas fa-check"></i>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // Message Skeleton Loader
        const MessageSkeleton = ({ isSent }) => {
            return (
                <div className={`message ${isSent ? 'sent' : 'received'} skeleton`} style={{ height: '60px' }}>
                </div>
            );
        };

        // Main Chat App
        const ChatApp = () => {
            const [darkMode, setDarkMode] = useState(true);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [activeChat, setActiveChat] = useState(null);
            const [messageInput, setMessageInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [showEmojiPicker, setShowEmojiPicker] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [showScrollButton, setShowScrollButton] = useState(false);
            const [isTyping, setIsTyping] = useState(false);
            
            const messagesEndRef = useRef(null);
            const messagesContainerRef = useRef(null);
            const emojiPickerRef = useRef(null);
            
            // Log authentication state changes
            useEffect(() => {
                console.log('Authentication state changed:', isAuthenticated);
            }, [isAuthenticated]);
            
            useEffect(() => {
                if (showEmojiPicker && emojiPickerRef.current) {
                    const handleEmojiSelect = (e) => {
                        setMessageInput(prev => prev + e.detail.unicode);
                        setShowEmojiPicker(false);
                    };
                    
                    emojiPickerRef.current.addEventListener('emoji-click', handleEmojiSelect);
                    
                    return () => {
                        if (emojiPickerRef.current) {
                            emojiPickerRef.current.removeEventListener('emoji-click', handleEmojiSelect);
                        }
                    };
                }
            }, [showEmojiPicker]);
            
            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('dark');
                    document.body.classList.remove('light');
                } else {
                    document.body.classList.add('light');
                    document.body.classList.remove('dark');
                }
            }, [darkMode]);
            
            useEffect(() => {
                if (activeChat) {
                    scrollToBottom();
                    setIsLoading(true);
                    
                    // Simulate message loading
                    setTimeout(() => {
                        setIsLoading(false);
                    }, 1000);
                }
            }, [activeChat]);
            
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };
            
            const handleScroll = () => {
                const { scrollTop } = messagesContainerRef.current;
                setShowScrollButton(scrollTop > 300);
            };
            
            const handleChatSelect = (chatId) => {
                setActiveChat(chatId);
                setIsSidebarOpen(false);
            };
            
            const handleSendMessage = (e) => {
                e.preventDefault();
                if (messageInput.trim() === '') return;
                
                // In a real app, we would send the message to the server
                // For the prototype, we'll just clear the input
                setMessageInput('');
                scrollToBottom();
            };
            
            const handleEmojiSelect = (emoji) => {
                setMessageInput(prev => prev + emoji.native);
                setShowEmojiPicker(false);
            };
            
            // Get active chat details
            const activeChatDetails = MOCK_CHATS.find(chat => chat.id === activeChat);
            const activeChatMessages = activeChat ? (MOCK_MESSAGES[activeChat] || []) : [];
            const activeChatUser = activeChatDetails 
                ? MOCK_USERS.find(user => {
                    if (activeChatDetails.isGroup) return activeChatDetails.name === user.name;
                    return activeChatDetails.users.includes(user.id) && user.id !== 'user1';
                  })
                : null;
            
            if (!isAuthenticated) {
                return (
                    <>
                        <AnimatedBackground />
                        <Auth onLogin={() => setIsAuthenticated(true)} />
                    </>
                );
            }
            
            return (
                <div className="app-container">
                    <AnimatedBackground />
                    
                    <div className="chat-container">
                        {/* Sidebar */}
                        <div className={`sidebar ${isSidebarOpen ? 'open' : ''}`}>
                            <div className="p-4 border-b dark:border-gray-700 flex justify-between items-center">
                                <h2 className="text-xl font-bold">Chats</h2>
                                <div className="flex items-center space-x-3">
                                    <button
                                        onClick={() => setDarkMode(!darkMode)}
                                        className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                                    >
                                        {darkMode ? (
                                            <i className="fas fa-sun"></i>
                                        ) : (
                                            <i className="fas fa-moon"></i>
                                        )}
                                    </button>
                                    <button className="md:hidden" onClick={() => setIsSidebarOpen(false)}>
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div className="p-4">
                                <div className="relative">
                                    <input
                                        type="text"
                                        placeholder="Search conversations..."
                                        className="w-full bg-gray-100 dark:bg-gray-700 rounded-full py-2 px-4 pr-10"
                                    />
                                    <span className="absolute right-3 top-2 text-gray-500">
                                        <i className="fas fa-search"></i>
                                    </span>
                                </div>
                            </div>
                            
                            <div className="overflow-y-auto" style={{ height: 'calc(100vh - 130px)' }}>
                                {MOCK_CHATS.map(chat => (
                                    <ChatListItem
                                        key={chat.id}
                                        chat={chat}
                                        users={MOCK_USERS}
                                        isActive={chat.id === activeChat}
                                        onClick={handleChatSelect}
                                    />
                                ))}
                            </div>
                        </div>
                        
                        {/* Chat Window */}
                        <div className="chat-window">
                            {activeChat ? (
                                <>
                                    {/* Chat Header */}
                                    <div className="chat-header flex items-center">
                                        <button 
                                            className="mr-3 md:hidden mobile-toggle"
                                            onClick={() => setIsSidebarOpen(true)}
                                        >
                                            <i className="fas fa-bars"></i>
                                        </button>
                                        
                                        <div className="relative">
                                            <img 
                                                src={activeChatUser?.avatar} 
                                                alt={activeChatUser?.name} 
                                                className="w-10 h-10 rounded-full object-cover"
                                            />
                                            <span className={`online-indicator absolute bottom-0 right-0 border-2 ${activeChatUser?.online ? 'online' : 'offline'} border-white dark:border-gray-800`}></span>
                                        </div>
                                        
                                        <div className="ml-3">
                                            <h3 className="font-semibold">{activeChatUser?.name}</h3>
                                            <p className="text-xs text-gray-500">
                                                {activeChatUser?.online ? 'Online' : 'Offline'}
                                                {activeChatDetails?.isGroup && ` • ${activeChatDetails.users.length} members`}
                                            </p>
                                        </div>
                                        
                                        <div className="ml-auto">
                                            <button className="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                                <i className="fas fa-phone"></i>
                                            </button>
                                            <button className="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                                <i className="fas fa-video"></i>
                                            </button>
                                            <button className="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                                <i className="fas fa-info-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Messages Container */}
                                    <div 
                                        className="messages-container" 
                                        ref={messagesContainerRef}
                                        onScroll={handleScroll}
                                    >
                                        {isLoading ? (
                                            // Show skeleton loaders while messages are loading
                                            <>
                                                <MessageSkeleton isSent={false} />
                                                <MessageSkeleton isSent={true} />
                                                <MessageSkeleton isSent={false} />
                                                <MessageSkeleton isSent={true} />
                                            </>
                                        ) : (
                                            <>
                                                {activeChatMessages.map(message => (
                                                    <Message 
                                                        key={message.id} 
                                                        message={message} 
                                                        user={MOCK_USERS.find(u => u.id === message.sender)}
                                                        isGroup={activeChatDetails?.isGroup}
                                                    />
                                                ))}
                                                
                                                {isTyping && (
                                                    <div className="typing-indicator">
                                                        <span className="mr-2">{activeChatUser?.name} is typing</span>
                                                        <div className="flex">
                                                            <div className="dot-typing"></div>
                                                            <div className="dot-typing" style={{ animationDelay: '0.2s' }}></div>
                                                            <div className="dot-typing" style={{ animationDelay: '0.4s' }}></div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                <div ref={messagesEndRef} />
                                                
                                                {showScrollButton && (
                                                    <button
                                                        className="scroll-to-top visible"
                                                        onClick={scrollToBottom}
                                                    >
                                                        <i className="fas fa-arrow-down"></i>
                                                    </button>
                                                )}
                                            </>
                                        )}
                                    </div>
                                    
                                    {/* Message Input */}
                                    <div className="message-input-container">
                                        {showEmojiPicker && (
                                            <div className="emoji-picker">
                                                <emoji-picker ref={emojiPickerRef}></emoji-picker>
                                            </div>
                                        )}
                                        
                                        <form onSubmit={handleSendMessage} className="flex items-center">
                                            <button 
                                                type="button"
                                                className="p-2 mr-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"
                                                onClick={() => {}}
                                            >
                                                <i className="fas fa-paperclip"></i>
                                            </button>
                                            
                                            <input
                                                type="text"
                                                value={messageInput}
                                                onChange={(e) => setMessageInput(e.target.value)}
                                                placeholder="Type a message..."
                                                className="message-input flex-grow focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            />
                                            
                                            <button 
                                                type="button"
                                                className="p-2 mx-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"
                                                onClick={() => setShowEmojiPicker(!showEmojiPicker)}
                                            >
                                                <i className="far fa-smile"></i>
                                            </button>
                                            
                                            <button
                                                type="submit"
                                                className="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-full w-10 h-10 flex items-center justify-center"
                                            >
                                                <i className="fas fa-paper-plane"></i>
                                            </button>
                                        </form>
                                    </div>
                                </>
                            ) : (
                                <div className="flex flex-col items-center justify-center h-full text-center">
                                    <img 
                                        src="https://cdn.pixabay.com/photo/2016/11/30/17/11/chat-1873536_1280.png" 
                                        alt="Select a chat" 
                                        className="w-1/4 max-w-xs mb-4 opacity-50"
                                    />
                                    <h2 className="text-xl font-semibold mb-2">Select a conversation</h2>
                                    <p className="text-gray-500 max-w-md px-4">
                                        Choose a chat from the sidebar or start a new conversation to begin messaging.
                                    </p>
                                    <button 
                                        className="mt-6 p-2 md:hidden bg-indigo-600 text-white rounded-lg"
                                        onClick={() => setIsSidebarOpen(true)}
                                    >
                                        Show conversations
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<ChatApp />);
        } catch (error) {
            console.error('Error rendering app:', error);
            document.body.innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <h2>Error loading chat application</h2>
                    <p>${error.message}</p>
                    <p>Please check the console for more details.</p>
                </div>
            `;
        }
    </script>
</body>
</html>